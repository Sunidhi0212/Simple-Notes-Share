<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Simple Notes – Shareable</title>
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- LZ-String for URL-safe compression -->
  <script src="https://cdn.jsdelivr.net/npm/lz-string@1.5.0/libs/lz-string.min.js"></script>
  <meta name="description" content="A tiny notes app with localStorage, CRUD, and shareable links via URL hash." />
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' rx='16' fill='%230ea5e9'/%3E%3Cpath fill='white' d='M25 25h50v8H25zm0 16h50v8H25zm0 16h36v8H25z'/%3E%3C/svg%3E" />
  <style>
    html, body, #app { height: 100%; }
    .btn { @apply px-3 py-2 rounded-xl shadow-sm border text-sm; }
    .btn-primary { @apply bg-blue-600 text-white border-blue-600 hover:bg-blue-700; }
    .btn-ghost { @apply border-gray-200 hover:bg-gray-50; }
    .btn-danger { @apply bg-red-600 text-white border-red-600 hover:bg-red-700; }
    .note-active { @apply ring-2 ring-blue-500; }
  </style>
</head>
<body class="min-h-screen bg-gray-50 text-gray-800">
   <script>
    const storedEmail = localStorage.getItem('notesAppEmail');
    const storedPassword = localStorage.getItem('notesAppPassword');

    if (!storedEmail || !storedPassword) {
      alert('Please sign up first.');
      window.location.href = "signup.html";
    }
  </script>
  <div id="app" class="h-full">
    <!-- Header -->
    <header class="sticky top-0 z-10 bg-white/80 backdrop-blur border-b">
      <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
        <div class="flex items-center gap-2">
          <svg width="28" height="28" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><rect width="100" height="100" rx="16" fill="#0ea5e9"/><path fill="white" d="M25 25h50v8H25zm0 16h50v8H25zm0 16h36v8H25z"/></svg>
          <h1 class="text-xl font-semibold">Simple Notes</h1>
          <span class="ml-2 text-xs text-gray-500">(local • offline • shareable)</span>
        </div>
        <div class="flex items-center gap-2">
          <button id="exportBtn" class="btn btn-ghost" title="Download all notes as JSON">Export</button>
          <label class="btn btn-ghost cursor-pointer" title="Import notes from JSON">
            Import <input id="importInput" type="file" accept="application/json" class="hidden" />
          </label>
          <a href="https://github.com/new" target="_blank" class="btn btn-ghost" title="Deploy this to Vercel via GitHub">
            Deploy ↗
          </a>
        </div>
      </div>
    </header>

    <!-- Main -->
    <main class="max-w-6xl mx-auto grid grid-cols-1 md:grid-cols-3 gap-4 p-4">
      <!-- Sidebar: Notes List -->
      <aside class="md:col-span-1">
        <div class="flex mb-3 gap-2">
          <button id="newBtn" class="btn btn-primary w-full">+ New Note</button>
        </div>
        <div class="bg-white rounded-2xl border shadow-sm overflow-hidden">
          <div class="p-2 border-b flex items-center gap-2">
            <input id="search" class="w-full px-3 py-2 rounded-xl bg-gray-50 border outline-none" placeholder="Search notes..." />
          </div>
          <ul id="notesList" class="max-h-[65vh] overflow-auto divide-y"></ul>
        </div>
      </aside>

      <!-- Editor -->
      <section class="md:col-span-2">
        <div class="bg-white rounded-2xl border shadow-sm p-4 h-full flex flex-col gap-3">
          <input id="titleInput" class="text-xl font-semibold px-2 py-2 rounded-xl bg-gray-50 border outline-none" placeholder="Note title" />
          <textarea id="bodyInput" class="min-h-[40vh] grow px-3 py-3 rounded-xl bg-gray-50 border outline-none" placeholder="Start typing..."></textarea>
          <div class="flex flex-wrap gap-2 justify-between items-center">
            <div class="text-xs text-gray-500" id="meta"></div>
            <div class="flex gap-2">
              <button id="saveBtn" class="btn btn-primary">Save</button>
              <button id="shareBtn" class="btn btn-ghost">Share Link</button>
              <button id="deleteBtn" class="btn btn-danger">Delete</button>
            </div>
          </div>
          <p class="text-xs text-gray-500">Tip: Sharing uses a URL hash (no server). Anyone with the link can import a read‑only copy.</p>
        </div>
      </section>
    </main>
  </div>

  <script>
   //--login---
    const storedEmail = localStorage.getItem('notesAppEmail');
const storedPassword = localStorage.getItem('notesAppPassword');

if (!storedEmail || !storedPassword) {
  alert('Please sign up first.');
  window.location.href = "signup.html";
}
    // ---- Utilities ----
    const $ = sel => document.querySelector(sel);
    const $$ = sel => document.querySelectorAll(sel);
    const nowISO = () => new Date().toISOString();
    const fmt = ts => new Date(ts).toLocaleString();
    const uid = () => crypto.randomUUID ? crypto.randomUUID() : (Math.random().toString(36).slice(2) + Date.now());

    const STORAGE_KEY = 'simple-notes-v1';

    function loadNotes() {
      try { return JSON.parse(localStorage.getItem(STORAGE_KEY)) || []; }
      catch { return []; }
    }

    function saveNotes(list) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(list));
    }

    function upsertNote(note) {
      const list = loadNotes();
      const i = list.findIndex(n => n.id === note.id);
      if (i === -1) list.unshift(note); else list[i] = note;
      saveNotes(list);
      return list;
    }

    function deleteNote(id) {
      const list = loadNotes().filter(n => n.id !== id);
      saveNotes(list);
      return list;
    }

    // ---- State ----
    let currentId = null;

    // ---- DOM elements ----
    const notesList = $('#notesList');
    const titleInput = $('#titleInput');
    const bodyInput = $('#bodyInput');
    const saveBtn = $('#saveBtn');
    const deleteBtn = $('#deleteBtn');
    const newBtn = $('#newBtn');
    const shareBtn = $('#shareBtn');
    const meta = $('#meta');
    const search = $('#search');
    const exportBtn = $('#exportBtn');
    const importInput = $('#importInput');

    // ---- Rendering ----
    function renderList(filter = '') {
      const list = loadNotes();
      const q = filter.trim().toLowerCase();
      const results = q ? list.filter(n => (n.title + ' ' + n.body).toLowerCase().includes(q)) : list;

      notesList.innerHTML = '';
      results.forEach(n => {
        const li = document.createElement('li');
        li.className = `p-3 cursor-pointer hover:bg-gray-50 ${n.id === currentId ? 'note-active' : ''}`;
        li.innerHTML = `
          <div class="flex items-center justify-between">
            <div class="font-medium truncate">${escapeHTML(n.title) || 'Untitled'}</div>
            <div class="text-xs text-gray-500 ml-2">${new Date(n.updatedAt).toLocaleDateString()}</div>
          </div>
          <div class="text-xs text-gray-500 truncate">${escapeHTML(n.body).slice(0, 120)}</div>
        `;
        li.addEventListener('click', () => selectNote(n.id));
        notesList.appendChild(li);
      });

      if (!results.length) {
        const empty = document.createElement('div');
        empty.className = 'p-6 text-center text-gray-400';
        empty.textContent = q ? 'No matches' : 'No notes yet. Create one!';
        notesList.appendChild(empty);
      }
    }

    function escapeHTML(str='') {
      return str.replace(/[&<>"]/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c]));
    }

    function selectNote(id) {
      const list = loadNotes();
      const note = list.find(n => n.id === id);
      if (!note) return;
      currentId = id;
      titleInput.value = note.title || '';
      bodyInput.value = note.body || '';
      meta.textContent = `Last edited ${fmt(note.updatedAt)} • ${note.body.length} chars`;
      renderList(search.value);
    }

    function newNote(prefill = {title: '', body: ''}) {
      const n = { id: uid(), title: prefill.title || '', body: prefill.body || '', createdAt: nowISO(), updatedAt: nowISO() };
      upsertNote(n);
      currentId = n.id;
      selectNote(n.id);
    }

    function saveCurrent() {
      if (!currentId) return;
      const list = loadNotes();
      const i = list.findIndex(n => n.id === currentId);
      if (i === -1) return;
      list[i].title = titleInput.value.trim();
      list[i].body = bodyInput.value;
      list[i].updatedAt = nowISO();
      saveNotes(list);
      meta.textContent = `Saved ${fmt(list[i].updatedAt)} • ${list[i].body.length} chars`;
      renderList(search.value);
    }

    function deleteCurrent() {
      if (!currentId) return;
      const sure = confirm('Delete this note? This action cannot be undone.');
      if (!sure) return;
      const list = deleteNote(currentId);
      currentId = list[0]?.id || null;
      if (currentId) selectNote(currentId); else { titleInput.value = ''; bodyInput.value=''; meta.textContent=''; }
      renderList(search.value);
    }

    // ---- Sharing via URL hash ----
    function buildShareURL(note) {
      const payload = JSON.stringify({title: note.title, body: note.body});
      const compressed = LZString.compressToEncodedURIComponent(payload);
      const base = location.origin + location.pathname;
      return `${base}#n=${compressed}`;
    }

    function importFromHash() {
      if (!location.hash.startsWith('#n=')) return false;
      try {
        const data = location.hash.slice(3);
        const json = LZString.decompressFromEncodedURIComponent(data);
        const obj = JSON.parse(json);
        newNote({title: obj.title || 'Imported Note', body: obj.body || ''});
        // Clear the hash to avoid re-import on refresh
        history.replaceState(null, '', location.pathname + location.search);
        alert('Note imported from link. It is now editable and saved locally.');
        return true;
      } catch (e) {
        console.error(e);
        alert('Failed to import note from link.');
        return false;
      }
    }

    async function shareCurrent() {
      const list = loadNotes();
      const note = list.find(n => n.id === currentId);
      if (!note) return;
      const url = buildShareURL(note);
      try {
        await navigator.clipboard.writeText(url);
        alert('Share link copied to clipboard!');
      } catch {
        prompt('Copy this link:', url);
      }
    }

    // ---- Export / Import JSON ----
    function exportAll() {
      const blob = new Blob([JSON.stringify(loadNotes(), null, 2)], {type: 'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'notes.json'; a.click();
      URL.revokeObjectURL(url);
    }

    function importJSON(file) {
      const reader = new FileReader();
      reader.onload = () => {
        try {
          const arr = JSON.parse(reader.result);
          if (!Array.isArray(arr)) throw new Error('Invalid file');
          const existing = loadNotes();
          const merged = [...arr, ...existing].reduce((map, n) => (map.set(n.id || uid(), {...n, id: n.id || uid()}), map), new Map());
          saveNotes(Array.from(merged.values()).sort((a,b)=> new Date(b.updatedAt) - new Date(a.updatedAt)));
          renderList(search.value);
          if (!currentId && loadNotes()[0]) selectNote(loadNotes()[0].id);
          alert('Imported notes successfully.');
        } catch (e) {
          alert('Import failed. Make sure it\'s a valid JSON exported from this app.');
        }
      };
      reader.readAsText(file);
    }

    // ---- Event bindings ----
    newBtn.addEventListener('click', () => newNote());
    saveBtn.addEventListener('click', saveCurrent);
    deleteBtn.addEventListener('click', deleteCurrent);
    shareBtn.addEventListener('click', shareCurrent);
    search.addEventListener('input', e => renderList(e.target.value));
    exportBtn.addEventListener('click', exportAll);
    importInput.addEventListener('change', e => {
      const f = e.target.files?.[0];
      if (f) importJSON(f);
      importInput.value = '';
    });

    // Ctrl/Cmd+S to save
    document.addEventListener('keydown', (e) => {
      if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 's') {
        e.preventDefault();
        saveCurrent();
      }
    });

    // Auto-save on blur
    titleInput.addEventListener('blur', saveCurrent);
    bodyInput.addEventListener('blur', saveCurrent);

    // Init
    (function init(){
      // Import from share link if present
      if (!importFromHash()) {
        const list = loadNotes();
        if (list[0]) { currentId = list[0].id; selectNote(currentId); }
        else { newNote({title: 'Welcome 👋', body: 'I am Sunidhi .This is a tiny notes app. Create, edit, delete notes.\n\nClick “Share Link” to copy a URL that contains this note (no server needed). Open that link on any device to import a copy.'}); }
      }
      renderList();
    })();
  </script>
</body>
</html>
